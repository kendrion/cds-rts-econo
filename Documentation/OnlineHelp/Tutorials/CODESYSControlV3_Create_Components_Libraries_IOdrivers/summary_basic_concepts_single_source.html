

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Single Source, Macros and M4 &#8212; RuntimeSystemDocumentation V3.5.16.40</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/theme.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Macros for Function Calls" href="summary_basic_concepts_macros.html" />
    <link rel="prev" title="Component based Architecture" href="summary_basic_concepts_architecture.html" /> 
  </head><body>
	<div id="header">
		<a href="#" title="CODESYS" target="_top" id="logo"><img src="../../_static/logo.png" width="134" height="130" alt=""></a>
		<a href="#" title="CODESYS Documentation" target="_top" id="logo-store"><img src="../../_static/logo2.png" width="137" height="130" alt=""></a>
	</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="summary_basic_concepts_macros.html" title="Macros for Function Calls"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="summary_basic_concepts_architecture.html" title="Component based Architecture"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">RuntimeSystemDocumentation V3.5.16.40</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >6. Tutorials / HowTos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >6.2.3. Creating Runtime System Components, Libraries and I/O Drivers</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="summary_basic_concepts.html" accesskey="U">6.2.3.2. Summary of basic concepts</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h4>Previous topic</h4>
  <p class="topless"><a href="summary_basic_concepts_architecture.html"
                        title="previous chapter">Component based Architecture</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="summary_basic_concepts_macros.html"
                        title="next chapter">Macros for Function Calls</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="single-source-macros-and-m4">
<span id="summary-basic-concepts-single-source"></span><h1>Single Source, Macros and M4<a class="headerlink" href="#single-source-macros-and-m4" title="Permalink to this headline">¶</a></h1>
<p>As the runtime system is implemented in C language, the components
consist of C source file(s) (<em>.c) and header files (</em>.h).</p>
<p>The runtime supports</p>
<ul class="simple">
<li><p>static linking: all C files are linked to one binary by the linker,
and</p></li>
<li><p>dynamic linking: every component is compiled to a separate library
(e.g. .dll or .so)</p></li>
<li><p>mixed linking: some components are statically linked, others are
linked as separate libraries</p></li>
</ul>
<p>To support single source for static, dynamic and mixed linking, macros
are used for function calls, especially if functions from another
component are called. These macros are defined in the header files.</p>
<p>Every component has two header files: the interface file and the
dependency file.</p>
<ul class="simple">
<li><p>Interface .h file: Called Cmp*Itf.h, contains declarations for
exported functions</p></li>
<li><p>Dependency .h file: Called Cmp*Dep.h, contains import declarations</p></li>
</ul>
<p>As many macros are needed for all the functions, we are using a tool to
generate the header files with the macros. This tool is called the “m4”
preprocessor. This tool is provided with the runtime delivery.</p>
<p>The source files for the header files are also called m4 files. As there
are two header files for every component, there are also two m4 files:</p>
<ul class="simple">
<li><p>Interface .m4 file: Called Cmp*Itf.m4, contains declarations for
exported functions</p></li>
<li><p>Dependency .m4 file: Called Cmp*Dep.m4, contains import declarations</p></li>
</ul>
<p><strong>When writing a component, do not edit the header files directly. Only
edit the .m4 files! Then, generate the .h files with the m4 tool.</strong></p>
<p>The following drawing illustrates the structure of the source files of a
component:</p>
<p><a class="reference internal" href="../../_images/image26.png"><img alt="image2" src="../../_images/image26.png" style="width: 656.0px; height: 245.5px;" /></a></p>
<p>In the template components, some batch files are provided. They call the
m4 preprocessor to generate the .h files from the .m4 files.</p>
<p>If your components has a new dependency on another component, e.g. you
want to call a function from another component, you need to configure
this new dependency. You can do that in the Dep.m4 file of your
component. You need to add the component interface, that you want to use
with “USE_ITF”, and you need to specify which function you want to use
with “REQUIRED_IMPORTS” or “OPTIONAL_IMPORTS”.</p>
<p>Example:</p>
<p>If you want to use the functions EventOpen and EventClose from runtime
component CmpEventMgr (which is implementing the interface
“CmpEventMgrItf”, declared in CmpEventMgrItf.m4), add this new
dependency to your Dep.m4 file:</p>
<div class="highlight-c# notranslate"><div class="highlight"><pre><span></span>USE_ITF(&#39;CmpEventMgrItf.m4&#39;)

REQUIRED_IMPORTS(
EventOpen,
EventClose)
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="summary_basic_concepts_macros.html" title="Macros for Function Calls"
             >next</a> |</li>
        <li class="right" >
          <a href="summary_basic_concepts_architecture.html" title="Component based Architecture"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">RuntimeSystemDocumentation V3.5.16.40</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >6. Tutorials / HowTos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >6.2.3. Creating Runtime System Components, Libraries and I/O Drivers</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="summary_basic_concepts.html" >6.2.3.2. Summary of basic concepts</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, 3S-Smart Software Solutions GmbH. This document is confidential. Unauthorized copying, disclosure or distribution of this document and the information contained herein is strictly forbidden.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>