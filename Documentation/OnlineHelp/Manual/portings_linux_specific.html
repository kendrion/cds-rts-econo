

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>5.4.2. Linux specific information &#8212; RuntimeSystemDocumentation V3.5.16.40</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/theme.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.4.3. VxWorks Specific Information" href="portings_vxworks_specific.html" />
    <link rel="prev" title="5.4.1. Windows Specific Information" href="portings_win_specific.html" /> 
  </head><body>
	<div id="header">
		<a href="#" title="CODESYS" target="_top" id="logo"><img src="../_static/logo.png" width="134" height="130" alt=""></a>
		<a href="#" title="CODESYS Documentation" target="_top" id="logo-store"><img src="../_static/logo2.png" width="137" height="130" alt=""></a>
	</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="portings_vxworks_specific.html" title="5.4.3. VxWorks Specific Information"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="portings_win_specific.html" title="5.4.1. Windows Specific Information"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RuntimeSystemDocumentation V3.5.16.40</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >5. Architecture Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="portings.html" accesskey="U">5.4. Portings</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h4>Previous topic</h4>
  <p class="topless"><a href="portings_win_specific.html"
                        title="previous chapter">5.4.1. Windows Specific Information</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="portings_vxworks_specific.html"
                        title="next chapter">5.4.3. VxWorks Specific Information</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="linux-specific-information">
<span id="portings-linux-specific"></span><h1>5.4.2. Linux specific information<a class="headerlink" href="#linux-specific-information" title="Permalink to this headline">¶</a></h1>
<p>On Linux systems the runtime is a user space application. For realtime
behavior the realtime-preempt patches from Ingo Molnar and Thomas Gleixner
are needed. But the integration is transparent, so a standard vanilla kernel
or a standard Linux distribution like e.g. debian also may be used.</p>
<p>For full functionality the runtime has to be started with root
privileges. Starting it as a regular user is possible, but the
following functionality will fail and this causes severe drawbacks.
There might be the possibility to set specific capabilities (see
manpage capabilities) or resource limits (see manpage setrlimit) to
avoid this:</p>
<ul class="simple">
<li><p>set realtime priority (SCHED_FIFO) for threads -&gt; no realtime tasks
possible</p></li>
<li><p>lock process memory via mlockall() -&gt; realtime behavior might be bad</p></li>
<li><p>creating raw sockets -&gt; ethernet based fieldbusses will not work</p></li>
<li><p>ifconfig up/down -&gt; baudrate for CAN bus can’t be set</p></li>
</ul>
<div class="section" id="can-bus">
<h2>5.4.2.1. CAN bus<a class="headerlink" href="#can-bus" title="Permalink to this headline">¶</a></h2>
<p>For CAN bus access you have to provide a script for setting the
baudrate of the CAN bus. The default name is “rts_set_baud.sh” and
it will be called “./rts_set_baud.sh &lt;interfacename&gt;
&lt;baudrate/1000&gt;”.
Usually this can be done by the “ip link” command and the
implementation may look like this:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span>#!/bin/sh
BITRATE=`expr $2 \\* 1000`
ifconfig $1 down
echo ip link set $1 type can bitrate $BITRATE
ip link set $1 type can bitrate $BITRATE
ifconfig $1 up;
</pre></div>
</div>
<p>For further templates refer to the
Platforms/Linux/Templates/rts_set_baud folder of your toolkit.
Configuration options are documented in the CODESYS Help -&gt;
CmpSocketCanDrvItf.</p>
</div>
<div class="section" id="environment-variables-and-command-line-parameters">
<span id="portings-linux-specific-cmdline"></span><h2>5.4.2.2. Environment variables and command line parameters<a class="headerlink" href="#environment-variables-and-command-line-parameters" title="Permalink to this headline">¶</a></h2>
<div class="section" id="command-line-parameters">
<h3>Command line parameters:<a class="headerlink" href="#command-line-parameters" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Usage: codesyscontrol [OPTION]… [ConfigurationFile]</div>
<div class="line">If [ConfigurationFile] isn’t specified, a file named
CODESYSControl.cfg is expected to reside in the working directory of
the runtime system</div>
</div>
<div class="line-block">
<div class="line">Valid options:</div>
<div class="line">-h, –help display this help and exit</div>
<div class="line">-v, –version display version information and exit</div>
<div class="line">d[level], –debug print additonal debug output</div>
<div class="line">-b, –daemon run in the background</div>
<div class="line">–printlostcycles print debug output if a cycle in a realtime iec
tasks is lost</div>
</div>
</div>
<div class="section" id="environment-variables">
<h3>Environment variables:<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h3>
<p>There are some environment variables to influence the behavior of the runtime.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>PlcConfigFile=&lt;path/filename&gt;</p></td>
<td><p>use this file as configuration file. Path is optional. Only evaluated if the configuration file was not set as a command line parameter.</p></td>
</tr>
<tr class="row-even"><td><p>QWS_COMMANDLINE_PARAM</p></td>
<td><p>QT parameters to be passed to the implicitly generated QT Application (default: “-qws”).</p></td>
</tr>
<tr class="row-odd"><td><p>QT_QPA_NO_SIGNAL_HANDLER=1</p></td>
<td><p>Disable Qt signal handling. Use if runtime does not exit cleanly when pressing Ctrl-C</p></td>
</tr>
</tbody>
</table>
<p>Target visualization on top of X11 based QT only:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>RTS_WINDOW_MAXIMIZED</p></td>
<td><p>not set: full screen mode(default) set(any value): maximized window</p></td>
</tr>
<tr class="row-even"><td><p>RTS_CURSER_VISIBLE=0|1</p></td>
<td><p>0: hide cursor 1: show cursor(default)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="task-mapping">
<h2>5.4.2.3. Task Mapping<a class="headerlink" href="#task-mapping" title="Permalink to this headline">¶</a></h2>
<p>For information about task priorities in the runtime refer to chapter
3.7. The runtime priorities are mapped to the Linux priorities according
to this scheme:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 23%" />
<col style="width: 25%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>runtime priority</p></th>
<th class="head"><p>Linux priority (default)</p></th>
<th class="head"><p>Corresponding IEC Task priority</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Name</p></td>
<td><p>Value (default)</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>System Base</p></td>
<td><p>0</p></td>
<td><p>88 (SCHED_FIFO)</p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>System End</p></td>
<td><p>31</p></td>
<td><p>57 (SCHED_FIFO)</p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>RealTime Base</p></td>
<td><p>32</p></td>
<td><p>56 (SCHED_FIFO)</p></td>
<td><p>0 (highest realtime Prio)</p></td>
</tr>
<tr class="row-even"><td><p>RealTime Base + 15</p></td>
<td><p>47</p></td>
<td><p>41 (SCHED_FIFO)</p></td>
<td><p>15 (lowest realtime Prio)</p></td>
</tr>
<tr class="row-odd"><td><p>RealTime Base + 16</p></td>
<td><p>48</p></td>
<td><p>0 (SCHED_OTHER)</p></td>
<td><p>16 (non realtime Prio)</p></td>
</tr>
<tr class="row-even"><td><p>RealTime End</p></td>
<td><p>63</p></td>
<td><p>0 (SCHED_OTHER)</p></td>
<td><p>31 (non realtime Prio)</p></td>
</tr>
<tr class="row-odd"><td><p>High Base</p></td>
<td><p>&gt;= 64</p></td>
<td><p>0 (SCHED_OTHER)</p></td>
<td><p>–</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">If the runtime priority is in the range SystemBase-RealtimeBase+15 the
Linux scheduling policy is set to SCHED_FIFO and the priority is
computed this way:</div>
<div class="line">max_priority_os – &lt;value of runtime priority&gt;.</div>
<div class="line">Otherwise it is set to SCHED_OTHER with priority 0.</div>
<div class="line">The max_priority_os (default 88) may be set in the configuration file (SysTask-&gt;Linux.MaxOSPriority).
Valid Values are 49 to 99.</div>
<div class="line">So it is possible to change this mapping either by changing the values of the
runtime priorities or by changing the value of the maximum of the used linux priorities.
Both is described in the documentation of SysTaskItf.</div>
</div>
</div>
<div class="section" id="multicore">
<h2>5.4.2.4. Multicore<a class="headerlink" href="#multicore" title="Permalink to this headline">¶</a></h2>
<p id="id1">By default Linux is balancing the processes and threads across all
available cores. To avoid this behavior on multicore systems, it is
recommended to use the Linux tool “taskset”.</p>
<p>For example:</p>
<p>taskset -a 02 codesyscontrol /etc/CODESYSControl.cfg</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CODESYS doesn’t support the multicore processing on all systems.
Please ask our support if you are unsure if your system supports this.</p>
</div>
</div>
<div class="section" id="filesystem-layout">
<span id="portings-linux-specific-filesystem"></span><h2>5.4.2.5. Filesystem layout<a class="headerlink" href="#filesystem-layout" title="Permalink to this headline">¶</a></h2>
<p>Based on the “Filesystem Hierarchy Standard”, we are recommending the
following filesystem layout for CODESYS Runtime, running on Linux:</p>
<ul>
<li><div class="line-block">
<div class="line">/etc – runtime configuration files (e.g. CODESYSControl.cfg)</div>
<div class="line">As some sections of the runtime configuration file are changed
during runtime (e.g. [CmpApp]), you may want to split the file into
a user writeable and a static one. If /etc is write protected, you
may want to move the user writeable file to a writeable directory
and link it to /etc.</div>
<div class="line">Also the license file 3S.dat, shall be placed under /etc. It can be
mapped there with the following entry in the configuration file:</div>
<div class="line">[SysFile]</div>
<div class="line">FilePath.1=/etc/, 3S.dat</div>
</div>
</li>
<li><div class="line-block">
<div class="line">/var/opt/&lt;package-name&gt; - application specific files</div>
<div class="line">The application specific files can be mapped with a setting in the
configuration file:</div>
<div class="line">[SysFile]</div>
<div class="line">FilePath=/var/opt/&lt;package-name&gt;/</div>
<div class="line">By default the working directory of the runtime will be used.</div>
<div class="line">This is normally the working directory of the runtime process / service</div>
<div class="line">Please be aware, that all files you put here can be accessed via CODESYS</div>
<div class="line">file transfer feature!</div>
</div>
</li>
<li><div class="line-block">
<div class="line">/opt/&lt;package-name&gt; - CODESYS Control binaries, scripts, etc…</div>
<div class="line">All binaries, scripts, etc. which are necessary to run CODESYS,
should be placed under “/opt/&lt;package-name&gt;/”.</div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See further documentation about filepaths and wildcard mechanism.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Shared libraries, which are solely runtime dependent, should be placed
under /opt/&lt;package-name&gt;, too. Otherwise they will be mixed up with system libraries.</p>
</div>
<p>In general it is recommended to use read-only mounted file-systems as
far as possible. It is good to differentiate between three categories of
files:</p>
<ol class="arabic">
<li><div class="line-block">
<div class="line">Read-Only:</div>
<div class="line">The whole filesystem shall be read-only by default.</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Read/Write:</div>
<div class="line">All files, which are accessible by CODESYS have to be writeable and
readable. Specifically this will be /var/opt/&lt;package-name&gt;, but
might also be the whole /var folder.</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Temporary:</div>
<div class="line">Log files and those which don’t have to be stored across reboots,
could be placed in a temporary filesystem (of type tempfs).
Specifically this is important for /tmp.</div>
</div>
</li>
</ol>
</div>
<div class="section" id="build-static-runtime">
<h2>5.4.2.6. Build static runtime<a class="headerlink" href="#build-static-runtime" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Every CODESYS Linux Toolkit contains a static library beside the
CODESYS binary. This library archive can be used to statically build
customized runtimes. For example:</div>
</div>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">gcc</span> <span class="o">-</span><span class="n">o</span> <span class="n">codesyscontrol</span> <span class="n">main</span><span class="p">.</span><span class="n">c</span> <span class="n">codesyscontrol</span><span class="p">.</span><span class="n">a</span>
</pre></div>
</div>
<p>To extend the runtime with more components, which are also statically
linked, the list of static components from “profile.h” has to be
extended.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The use of the CODESYS Runtime as a shared object is not recommended,
and no longer supported. Instead it is recommended to use the static
library approach to link all runtime components together. If it is
necessary to use the CODESYS Runtime as shared object, no dynamic components shall be used.</p>
</div>
</div>
<div class="section" id="getting-started-with-your-linux-delivery">
<h2>5.4.2.7. Getting started with your Linux delivery<a class="headerlink" href="#getting-started-with-your-linux-delivery" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>extend functionality by own IEC library
write an IEC function in an own IEC library to access “firmware”/C-functions in your own runtime component.
see “How to write an external IEC function”</p></li>
<li><p>use event mechanism (CmpEventMgr)
see “How to register to an event in an own component”
Recommended Template: CmpTemplateEvent
Example: CmpPlcWink</p></li>
<li><p>configure Retain mechanism (CmpRetain):
see “How to configure Retains easyily with CmpRetainsMMap”
Recommended Template and example: CmpRetainsMMap</p></li>
<li><p>write own IO driver:
see “How to write a very simple IO driver”
Recommended Template and example: “IoDrvVerySimple”</p></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="portings_vxworks_specific.html" title="5.4.3. VxWorks Specific Information"
             >next</a> |</li>
        <li class="right" >
          <a href="portings_win_specific.html" title="5.4.1. Windows Specific Information"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RuntimeSystemDocumentation V3.5.16.40</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >5. Architecture Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="portings.html" >5.4. Portings</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, 3S-Smart Software Solutions GmbH. This document is confidential. Unauthorized copying, disclosure or distribution of this document and the information contained herein is strictly forbidden.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>