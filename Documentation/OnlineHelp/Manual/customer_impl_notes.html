

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>5.10.4. Implementation Notes &#8212; RuntimeSystemDocumentation V3.5.16.40</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/theme.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.10.5. Libraries" href="customer_libraries.html" />
    <link rel="prev" title="5.10.3. Implementing own components" href="customer_impl_own_components.html" /> 
  </head><body>
	<div id="header">
		<a href="#" title="CODESYS" target="_top" id="logo"><img src="../_static/logo.png" width="134" height="130" alt=""></a>
		<a href="#" title="CODESYS Documentation" target="_top" id="logo-store"><img src="../_static/logo2.png" width="137" height="130" alt=""></a>
	</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="customer_libraries.html" title="5.10.5. Libraries"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="customer_impl_own_components.html" title="5.10.3. Implementing own components"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RuntimeSystemDocumentation V3.5.16.40</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >5. Architecture Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="customer.html" accesskey="U">5.10. Customer Adaptations and Expansions</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h4>Previous topic</h4>
  <p class="topless"><a href="customer_impl_own_components.html"
                        title="previous chapter">5.10.3. Implementing own components</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="customer_libraries.html"
                        title="next chapter">5.10.5. Libraries</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="implementation-notes">
<span id="customer-impl-notes"></span><h1>5.10.4. Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="error-returning">
<h2>5.10.4.1. Error returning<a class="headerlink" href="#error-returning" title="Permalink to this headline">¶</a></h2>
<p>Each function either returns an error code or a handle.</p>
<p>An error code is of type RTS_RESULT (int). The error codes are defined
in CmpErrors.h. If no error occurred ERR_OK = 0 is returned.</p>
<p>In the event of an error the handle of type RTS_HANDLE is
RTS_INVALID_HANDLE (=-1). If this is the case, an error code is
returned via a pointer.</p>
<p>Since the pointer test for error code NULL is required at many points,
the error code can be allocated with the following macro. This macro
contains an automatic test for NOT NULL.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">RTS_RESULT</span><span class="o">*</span> <span class="n">pResult</span><span class="p">;</span>
<span class="n">RTS_SETRESULT</span><span class="p">(</span><span class="n">pResult</span><span class="p">,</span> <span class="n">ERR_OK</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="memory">
<h2>5.10.4.2. Memory<a class="headerlink" href="#memory" title="Permalink to this headline">¶</a></h2>
<p>The runtime system should not require dynamic memory management. Even
so, an “unlimited” number of tasks should be possible.</p>
<p>The following procedure is used to achieve this:</p>
<p>A component intended for managing a variable number of structures (e.g.
tasks, applications, communication connections) uses a static memory for
a fixed number of units. The component creates a MemoryPool using the
CmpMemPool component. The MemoryPool contains a defined number of blocks
with a certain size. Once all blocks are assigned, each memory pool can
be extended dynamically.</p>
<p>The whole memory management is handled via the interface of the
CmpMemPool component.</p>
</div>
<div class="section" id="allocation-of-ids">
<h2>5.10.4.3. Allocation of IDs<a class="headerlink" href="#allocation-of-ids" title="Permalink to this headline">¶</a></h2>
<div class="section" id="vendor-id">
<h3>Vendor ID<a class="headerlink" href="#vendor-id" title="Permalink to this headline">¶</a></h3>
<p>The Vendor ID is allocated by 3S for each manufacturer. It uniquely
identifies the manufacturer. In the customer-specific component the
following define must be set.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define CMP_VENDORID &lt;VendorID&gt; </span><span class="cm">/*16 bit*/</span><span class="cp"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All necessary defines can be found in CmpItf.h</p>
</div>
</div>
<div class="section" id="component-id">
<h3>Component ID<a class="headerlink" href="#component-id" title="Permalink to this headline">¶</a></h3>
<p>Each component requires a unique, 32 bits long component ID. This ID is
generated from the Vendor ID and a component-specific ID. The high word
of the component ID corresponds to the Vendor ID, the low word to the
component-specific ID.</p>
<p>If a manufacturer re-implements a core component, only the high word
changes (i.e. the Vendor ID), but not the low word.</p>
<p>If a completely new component is implemented, the manufacturer must
allocate a new component-specific ID. The range between 0x2000 and
0xFFFF is available for this purpose.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define CMP_Template &lt;ID&gt; </span><span class="cm">/*16 bit*/</span><span class="cp"></span>
</pre></div>
</div>
<p>The range between 0x2000 and 0x3FFF is available for this purpose.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cm">/* OEM specific components */</span>
<span class="cp">#define CMPID_CmpStartOEM 0x00002000</span>
<span class="cp">#define CMPID_CmpEndOEM 0x00003FFF</span>
</pre></div>
</div>
<p>The component ID uniquely identifies the manufacturer who implemented
the component and indicates whether or not it is a core component.</p>
</div>
<div class="section" id="interface-id">
<h3>Interface ID<a class="headerlink" href="#interface-id" title="Permalink to this headline">¶</a></h3>
<p>The interface ID uniquely identifies an interface in the runtime system.
Each core component in the runtime system implements at least one
interface. Manufacturers can replace any core component with their own,
as long as it implements the same interface.</p>
<p>Please note, different components may implement the same interface.
Examples of these components are different IO and block drivers.</p>
<p>If a completely new component is implemented, the manufacturer must
allocate a new interface ID. The range between 0x2000 and 0x3FFF is
available for this purpose.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cm">/* OEM specific start id */</span>
<span class="cp">#define ITFID_ICmpStartOEM 0x00002000</span>
<span class="cp">#define ITFID_ICmpEndOEM 0x00003FFF</span>
</pre></div>
</div>
</div>
<div class="section" id="class-id">
<h3>Class ID<a class="headerlink" href="#class-id" title="Permalink to this headline">¶</a></h3>
<p>The class ID uniquely identifies the different classes in the C++
runtime system.</p>
<p>If a completely new component is implemented, the manufacturer must
allocate a new class ID. The range between 0x2000 and 0x3FFF is
available for this purpose.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cm">/* OEM specific start id */</span>
<span class="cp">#define CLASSID\_CCmpStartOEM 0x00002000</span>
<span class="cp">#define CLASSID\_CCmpEndOEM 0x00003FFF</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="importing-of-functions">
<h2>5.10.4.4. Importing of functions<a class="headerlink" href="#importing-of-functions" title="Permalink to this headline">¶</a></h2>
<p>Functions for other components must first be imported before they can be
used. All functions are imported via the GET_xxx macro in the
ImportFunctions() function. The component first has to be notified of
the functions via the USE_xxx macro. The IMPORT_STMT macro from the
dependency file consolidates all GET_xxx macros of the component. The
USE_STMT macro from the dependency file consolidates all USE_xxx
macros of the component.</p>
<p>The complete import generically handled via the general component
interface. When new components are developed, only functions to be
imported have to be included in the dependency description file (m4).
The m4 mechanism will then correctly generate the import statement and
function calls.</p>
</div>
<div class="section" id="calling-of-imported-functions">
<h2>5.10.4.5. Calling of imported functions<a class="headerlink" href="#calling-of-imported-functions" title="Permalink to this headline">¶</a></h2>
<p>Within a component imported functions are called with the CAL-xxx macro.
Since functions of optional components do not necessarily have to exist
in the runtime system, before an imported function is called its
existence should be verified. The CHK_xxx macro is used for this
purpose. A call looks as follows:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span>. . .
If (CHK\_xxxFunc)
{
  Result = CAL\_xxxFunc();
}
. . .
</pre></div>
</div>
</div>
<div class="section" id="exporting-of-functions">
<h2>5.10.4.6. Exporting of functions<a class="headerlink" href="#exporting-of-functions" title="Permalink to this headline">¶</a></h2>
<p>The component manager is notified of exported functions via the EXP_xxx
macro in function ExportFunctions(). The EXPORT_STMT macro from the
dependency file consolidates all EXP_xxx macros of the component.</p>
<p>Just like the import, the export of functions is handled by the general
component interface. The statements are generated by the m4 mechanism.
The functions to be exported must be specified in the interface
description file.</p>
</div>
<div class="section" id="linkage-with-the-runtime-system">
<h2>5.10.4.7. Linkage with the runtime system<a class="headerlink" href="#linkage-with-the-runtime-system" title="Permalink to this headline">¶</a></h2>
<p>The newly created component can be used in the runtime system provided
it implements the general interface, has its own IDs, and all required
header files have been generated. Two steps are required for this:</p>
<ol class="arabic">
<li><p>The component must be linked.</p>
<blockquote>
<div><p>The way in which the runtime system is linked is specified during
configuration of the runtime system (Chapter 3.1). Three options are
available: static, dynamic, or mixed.</p>
</div></blockquote>
</li>
</ol>
<ul class="simple">
<li><p>If the runtime system was linked <strong>statically</strong>, the new component
must be included in the workspace or the makefile, and the whole
runtime system must be recompiled.</p></li>
<li><p>In addition, an entry for this component must be added to the
MainLoadComponent function when linking statically</p></li>
<li><p>If the runtime system was linked <strong>dynamically</strong>, the new component
must be available as a reloadable module.</p></li>
<li><p>If the runtime system was linked in <strong>mixed</strong> mode, the component can
either be linked statically to the runtime system, or it can be
available as a reloadable module.</p></li>
</ul>
<ol class="arabic" start="2">
<li><p>The component manager must be notified of the component.</p>
<blockquote>
<div><p>As soon as the component was linked or is available as a module, the
component manager must be notified of the new component. This can be
done in different ways (see <a class="reference internal" href="ov_kernel_startup_shutdown.html#operating-mode"><span class="std std-ref">ov_kernel_startup_shutdown</span></a>):</p>
</div></blockquote>
</li>
</ol>
<ul class="simple">
<li><p>If the component is statically linked with the runtime system, it is
useful to include the new component in the static list of components.</p></li>
<li><p>If the new component is not to be included in the static list, it
must be listed in the dynamic list.</p></li>
</ul>
</div>
<div class="section" id="order-of-the-init-hooks">
<h2>5.10.4.8. Order of the INIT Hooks<a class="headerlink" href="#order-of-the-init-hooks" title="Permalink to this headline">¶</a></h2>
<p>Chapter <a class="reference internal" href="ov_kernel_startup_shutdown.html#ov-kernel-startup-shutdown"><span class="std std-ref">Startup and Shutdown</span></a> already explained the default actions which are executed
in the INIT Hooks of the core runtime components. Beside this, there are
some general rules for every hook, which need to be taken into account
when writing your own components.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="customer_libraries.html" title="5.10.5. Libraries"
             >next</a> |</li>
        <li class="right" >
          <a href="customer_impl_own_components.html" title="5.10.3. Implementing own components"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RuntimeSystemDocumentation V3.5.16.40</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >5. Architecture Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="customer.html" >5.10. Customer Adaptations and Expansions</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, 3S-Smart Software Solutions GmbH. This document is confidential. Unauthorized copying, disclosure or distribution of this document and the information contained herein is strictly forbidden.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>