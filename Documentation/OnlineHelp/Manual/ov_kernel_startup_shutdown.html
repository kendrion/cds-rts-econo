

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>5.3.1. Startup and Shutdown &#8212; RuntimeSystemDocumentation V3.5.16.40</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/theme.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.3.2. Component Manager" href="ov_kernel_component_manager.html" />
    <link rel="prev" title="5.3. Overview of the Kernel Components and Main Functions" href="overview_kernel.html" /> 
  </head><body>
	<div id="header">
		<a href="#" title="CODESYS" target="_top" id="logo"><img src="../_static/logo.png" width="134" height="130" alt=""></a>
		<a href="#" title="CODESYS Documentation" target="_top" id="logo-store"><img src="../_static/logo2.png" width="137" height="130" alt=""></a>
	</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ov_kernel_component_manager.html" title="5.3.2. Component Manager"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview_kernel.html" title="5.3. Overview of the Kernel Components and Main Functions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RuntimeSystemDocumentation V3.5.16.40</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >5. Architecture Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="overview_kernel.html" accesskey="U">5.3. Overview of the Kernel Components and Main Functions</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h4>Previous topic</h4>
  <p class="topless"><a href="overview_kernel.html"
                        title="previous chapter">5.3. Overview of the Kernel Components and Main Functions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ov_kernel_component_manager.html"
                        title="next chapter">5.3.2. Component Manager</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="startup-and-shutdown">
<span id="ov-kernel-startup-shutdown"></span><h1>5.3.1. Startup and Shutdown<a class="headerlink" href="#startup-and-shutdown" title="Permalink to this headline">¶</a></h1>
<p>The startup of the runtime system is executed in a strong layer based
way in order to avoid that a component calls another component that is
not initialized.</p>
<p>A defined shutdown is typically not possible on embedded targets. The
power is switched off there and the runtime system has no time to make a
defined shutdown. But on systems with e.g. an UPS a defined shutdown is
possible. For these cases, the runtime systems make a defined and
orderly shutdown.</p>
<div class="section" id="startup">
<h2>5.3.1.1. Startup<a class="headerlink" href="#startup" title="Permalink to this headline">¶</a></h2>
<p>The startup is done in the following main steps:</p>
<ol class="arabic simple">
<li><p>Basic settings of the runtime system are verified.</p></li>
<li><p>Components get loaded and initialized.</p></li>
<li><p>Boot project gets loaded, IEC tasks get created, application(s) get(s) started.</p></li>
<li><p>Communication server gets started and corresponding tasks get created.</p></li>
</ol>
<p>See in the following a more detailed description of the particular
steps:</p>
<ol class="arabic">
<li><p>The basic runtime system settings are checked (data types, byte order setting, etc.).</p></li>
<li><p>The component manager loads all so-called <em>system components</em>. The system components are components that are always loaded and initialized before all other components are loaded. For example the logger component for logging all start up events is such a system component.</p></li>
<li><p>The ComponentEntry() routine is called by every system component in order to link all components with the component manager.</p></li>
<li><p>The system components will be called to export their interface functions and to import the needed interface functions.</p></li>
<li><p>The component manager loads all other components (in the static linkage case, nothing must be done; in the dynamic linkage case, the components are loaded dynamically).</p></li>
<li><p>The ComponentEntry() routine is called by every component in order to link all components with the component manager.</p></li>
<li><p>The other components will be called to export their interface functions and to import the needed interface functions.</p></li>
<li><p>Initialization:</p>
<p>The initialization of the system components is done with the hook CH_INIT_SYSTEM.
In this hook, all systems components do their init code.</p>
<dl class="simple">
<dt>8.1. Right after CH_INIT_SYSTEM there is a second hook for the initialization of the system</dt><dd><p>components. It can be used to do some dependent stuff which needs a CH_INIT_SYSTEM before.</p>
</dd>
<dt>8.2. The initialization of all other components is done with the hook CH_INIT. Here all local</dt><dd><p>variables should be initialized.</p>
</dd>
<dt>8.3. The third level of initialization is done with the hook CH_INIT2.</dt><dd><p>In this hook, you can use all interfaces to other components! You can expect here, that all other components are initialized and can be used.
e.g. Events should be created here.</p>
</dd>
<dt>8.4. The fourth level of initialization is done with the hook CH_INIT3.</dt><dd><p>In this hook, you can use  all interfaces to other components! You can expect here, that all other components are initialized and can be used.
e.g. Registration on events should be done here.</p>
</dd>
<dt>8.5. The fifth level of initialization is done with the hook CH_INIT_SYSTEM_TASKS.</dt><dd><p>Here all tasks can be started, that are necessary e.g. for the operation of the IEC application.</p>
</dd>
<dt>8.6. The sixth of initialization is done with the hook CH_INIT_TASKS.</dt><dd><p>Here all other tasks can be started. Typically here the boot project is loaded and the PLC tasks are created.</p>
</dd>
<dt>8.7. The seventh level of initialization is done with the hook CH_INIT_COMM.</dt><dd><p>Here all level 7 servers are started to open the communication to the other systems.</p>
</dd>
</dl>
<p>8.8. To inform about that the initialization has finished, the hook CH_INIT_FINISHED is called.</p>
</li>
</ol>
<p>After the last hook (CH_INIT_FINISHED), the runtime system is
completely initialized and started.</p>
</div>
<div class="section" id="operating-mode">
<span id="id1"></span><h2>5.3.1.2. Operating mode<a class="headerlink" href="#operating-mode" title="Permalink to this headline">¶</a></h2>
<p>After the startup the runtime system goes into the operating mode. This
mode is done with a cyclic call of the hook CH_COMM_CYCLE. This hook
is called in the idle and main loop of the runtime system. In this hook
every component can do some background jobs.</p>
<p>In a single tasking system the hook is the only position where all jobs
are done, like communication, PLC task execution, etc.</p>
<p>The cycle time of the CH_COMM_CYCLE hook cannot be predicted. It
belongs on the jobs that are done in all components. So try to minimize
the jobs that are done in this hook to avoid an overloaded system!</p>
</div>
<div class="section" id="shutdown">
<h2>5.3.1.3. Shutdown<a class="headerlink" href="#shutdown" title="Permalink to this headline">¶</a></h2>
<p>An orderly shutdown of the runtime system is only possible on targets
with an UPS or with a defined shutdown. The shutdown is done by the
following hooks, which basically are the same as performed during
startup but in reverse order:</p>
<ol class="arabic simple">
<li><p>Deinitialization:</p></li>
</ol>
<blockquote>
<div><dl class="simple">
<dt>1.1. The first level of deinitialization is done in the hook</dt><dd><p>CH_EXIT_COMM. Here all level 7 servers should close their
communication channels and the server tasks.</p>
</dd>
<dt>1.2. The second level of deinitialization is done in the hook</dt><dd><p>CH_EXIT_TASKS. Here all active tasks should be deleted except
the tasks that are needed by the IEC application.</p>
</dd>
<dt>1.3. The third level of deinitialization is done in the hook</dt><dd><p>CH_EXIT_SYSTEM_TASKS. Here all tasks must be deleted.</p>
</dd>
<dt>1.4. The fourth level of deinitialization is done in the hook CH_EXIT3.</dt><dd><dl class="simple">
<dt>In the prepare exit hook, all components should unregister from</dt><dd><p>other components to dismiss the dependency to other components.</p>
</dd>
</dl>
</dd>
<dt>1.5. The fifth level of deinitialization is done in the hook CH_ EXIT2.</dt><dd><p>Here all local resources can be released, if they were occupied
in CH_INIT2.</p>
</dd>
<dt>1.6. The sixth level of deinitialization is done in the hook CH_ EXIT.</dt><dd><p>Here all local resources can be released and the deinitialization
of all components can be done.</p>
</dd>
<dt>1.7. The hook CH_EXIT_SYSTEM2 is called to deinitialize all system</dt><dd><p>components.</p>
</dd>
<dt>1.8. At least, the hook CH_EXIT_SYSTEM is called to deinitialize all</dt><dd><p>system components.</p>
</dd>
</dl>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><dl class="simple">
<dt>After the deinitialization, the components (except the system</dt><dd><p>components) are unloaded.</p>
</dd>
</dl>
</li>
<li><p>At least the system components are unloaded.</p></li>
</ol>
<p>After the unloading of the system components the runtime system is
completely down and released.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ov_kernel_component_manager.html" title="5.3.2. Component Manager"
             >next</a> |</li>
        <li class="right" >
          <a href="overview_kernel.html" title="5.3. Overview of the Kernel Components and Main Functions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RuntimeSystemDocumentation V3.5.16.40</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >5. Architecture Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="overview_kernel.html" >5.3. Overview of the Kernel Components and Main Functions</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, 3S-Smart Software Solutions GmbH. This document is confidential. Unauthorized copying, disclosure or distribution of this document and the information contained herein is strictly forbidden.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>