
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1.4.3. VxWorks Specific Information &#8212; RuntimeSystemOnlineHelp V3.5.14.0</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.5.14.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="RuntimeSystemOnlineHelp V3.5.14.0" href="../index.html" />
    <link rel="up" title="1.4. Portings" href="portings.html" />
    <link rel="next" title="1.4.4. Windows CE Specific Information" href="portings_win_ce_specific.html" />
    <link rel="prev" title="1.4.2. Linux specific information" href="portings_linux_specific.html" /> 
  </head>
  <body role="document">
	<div id="header">
		<a href="#" title="CODESYS" target="_top" id="logo"><img src="../_static/logo.png" width="134" height="130" alt=""></a>
		<a href="#" title="CODESYS Documentation" target="_top" id="logo-store"><img src="../_static/logo2.png" width="137" height="130" alt=""></a>
	</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="portings_win_ce_specific.html" title="1.4.4. Windows CE Specific Information"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="portings_linux_specific.html" title="1.4.2. Linux specific information"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RuntimeSystemOnlineHelp V3.5.14.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >1. CODESYS Control V3 - Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="portings.html" accesskey="U">1.4. Portings</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.4.3. VxWorks Specific Information</a><ul>
<li><a class="reference internal" href="#distributed-clocks">1.4.3.1. Distributed clocks</a><ul>
<li><a class="reference internal" href="#timer-sources">1.4.3.1.1. Timer sources</a></li>
<li><a class="reference internal" href="#performance-accuracy">1.4.3.1.2. Performance &amp; Accuracy</a></li>
<li><a class="reference internal" href="#jitter">1.4.3.1.3. Jitter</a></li>
<li><a class="reference internal" href="#static-memory-areas">1.4.3.1.4. Static Memory Areas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#global-object-pools">1.4.3.2. Global object pools</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="portings_linux_specific.html"
                        title="previous chapter">1.4.2. Linux specific information</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="portings_win_ce_specific.html"
                        title="next chapter">1.4.4. Windows CE Specific Information</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/Manual/portings_vxworks_specific.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="vxworks-specific-information">
<span id="portings-vxworks-specific"></span><h1>1.4.3. VxWorks Specific Information<a class="headerlink" href="#vxworks-specific-information" title="Permalink to this headline">¶</a></h1>
<p>Under VxWorks, we can use different timers as the tick source of the
runtime scheduler:</p>
<ul class="simple">
<li>Auxiliary Clock (if available)</li>
<li>System Clock</li>
<li>High priority task</li>
</ul>
<p>If users experience problems with „SysTimeGetUs&#8221; and „SysTimeGetNs&#8221;,
they can use their own implementations through the following settings in
CODESYSControl.cfg:</p>
<div class="highlight-C"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SysTime</span><span class="p">]</span>
<span class="n">VxWorks</span><span class="p">.</span><span class="n">CustomSysTimeGetUs</span><span class="o">=</span><span class="n">MySysTimeGetUs</span>
<span class="n">VxWorks</span><span class="p">.</span><span class="n">CustomSysTimeGetNs</span><span class="o">=</span><span class="n">MySysTimeGetNs</span>
</pre></div>
</div>
<p>The functions &#8220;MySysTimeGetUs&#8221; and &#8220;MySysTimeGetNs&#8221; represent functions
the user needs to implement in Firmware.</p>
<p>All PLC tasks are created as operating system threads and are triggered
by events from the runtime scheduler. The scheduling of the tasks is
done by the VxWorks scheduler.</p>
<p>Multicore CPUs under VxWorks 6.6 and newer are generally supported.
However, currently the runtime has to be bound exclusively to one core.
Load balancing of PLC tasks is not supported.</p>
<div class="section" id="distributed-clocks">
<h2>1.4.3.1. Distributed clocks<a class="headerlink" href="#distributed-clocks" title="Permalink to this headline">¶</a></h2>
<p>Distributed Clocks are used by some field busses (like EtherCAT) to
synchronize the cycle start times for all participants on the bus. For
this feature, we need some special support from the operating system,
because we need to modify the cycle times of the tasks with a fine
granularity of a few microseconds.</p>
<p>VxWorks doesn&#8217;t support this, because such a feature would need some
kind of one-shot timer and a non-cyclic scheduler. Because VxWorks
doesn&#8217;t support both, there is an own timeout scheduler implemented in
the CODESYS Runtime. To simulate a one-shot timer, this timeout
scheduler uses the cyclic timers, which are provided by VxWorks.</p>
<p>These are:</p>
<ul>
<li><div class="first line-block">
<div class="line"><strong>The System Timer:</strong>
| This timer is used by VxWorks for its own cyclic scheduler.
  Other tasks (from VxWorks or the User) may run into trouble
  when using this timer for distributed clocks. Because they may
  assume that they have a timer with a fixed period.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>The Auxiliary Timer:</strong>
| This timer is an additional timer, which is provided by VxWorks
  on some boards. It&#8217;s based on a completely independent timer
  source and therefore doesn&#8217;t interfere with other subsystems,
  when using it in one-shot mode.</div>
</div>
</li>
</ul>
<p>The Distributed Clocks feature can be enabled with the following setting
in the runtime configuration file:</p>
<div class="highlight-C"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SysTimer</span><span class="p">]</span>
<span class="n">VxWorks</span><span class="p">.</span><span class="n">TimerMode</span><span class="o">=</span><span class="n">OneShot</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If using this option, the clock which is assigned to the CODESYS runtime by
setting <strong>VxWorks.TimerSource</strong> will no longer tick periodically. This might
have influence on other applications running on the same platform.</p>
</div>
<div class="section" id="timer-sources">
<h3>1.4.3.1.1. Timer sources<a class="headerlink" href="#timer-sources" title="Permalink to this headline">¶</a></h3>
<p>When using distributed clocks, the selection of the timer source for the
runtime is even more critical than usually.</p>
<p>Using the system timer as a timing-source is in most cases very accurate
because the system timer can be programmed very accurate on most
systems. But if other programs are running on the same machine, this may
lead to an undefined behavior, because the system tick will occur
randomly for the second application.</p>
<p>Auxiliary timers need to be able to be programmed linearly with any
cycle time. For example on an x86, this is true for an Auxiliary APIC
timer but not for an Auxiliary RTC timer, because the RTC can only be
programmed with frequencies exponentially to the base of two.</p>
<p>If such an Auxiliary Timer is available, it might be the better choice,
because we don&#8217;t need to modify the system tick and we don&#8217;t disturb
other simultaneously running applications.</p>
</div>
<div class="section" id="performance-accuracy">
<h3>1.4.3.1.2. Performance &amp; Accuracy<a class="headerlink" href="#performance-accuracy" title="Permalink to this headline">¶</a></h3>
<p>Because we need to reprogram the timer on every tick, the overall system
performance will obviously decrease slightly. Also the number of
interrupts in our system will be higher, because the number of timer
interrupts increases. Beside our standard 1ms interrupts of the Runtime
Scheduler, we get additional interrupts for the new high-precision IEC
tasks.</p>
<p>To overcome this problem a little bit, it is recommendable to increase
the tick period of the Runtime Scheduler as much as possible. Because
all periodic IEC tasks are now scheduled over the high-precision timer,
this will only have effects on tasks which are triggered by event
variables. So increasing this to 10ms or even 100ms might be possible on
most systems. This can be done with the following setting in the Runtime
Configuration:</p>
<div class="highlight-C"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">CmpSchedule</span><span class="p">]</span>
<span class="n">SchedulerInterval</span><span class="o">=</span><span class="mi">100000</span>
</pre></div>
</div>
<p>When using one-shot timers, the tasks are still scheduled by the VxWorks
Scheduler, but are triggered from different „high-level schedulers&#8221;:</p>
<ul class="simple">
<li><strong>Cyclic Tasks:</strong> Triggered by the high-precision timeout scheduler.</li>
<li><strong>Event Tasks:</strong> Triggered by the Runtime Scheduler. The Variable is
checked in the Interval given in the configuration file.</li>
<li><strong>Freewheeling:</strong> Those tasks are running all the time, and are
interrupting themselves after every cycle for a small amount of
time to give control to the communication subsystem. The tasks
are woken up by the high-precision timeout scheduler.</li>
<li><strong>External Event Tasks:</strong> Triggered by an external Event. This can be
generated in every context and therefore depends on the context
where the event is generated.</li>
</ul>
</div>
<div class="section" id="jitter">
<h3>1.4.3.1.3. Jitter<a class="headerlink" href="#jitter" title="Permalink to this headline">¶</a></h3>
<p>Accuracy for all periodic tasks is obviously much higher now, but we
might notice some jitter when the timeouts of two tasks are overlapping.
In any case the task with the highest priority will be served first, but
this can lead to situations where a low-priority task is started and
slightly after this a high-priority task gets ready.</p>
<p>Without the Distributed Clocks, the execution of the tasks was
synchronized by the periodic system tick. Therefore all tasks where
executed serialized, one after another. This means, that the task cycle
time was optimal and shorter before. Now low-priority tasks can be
interrupted by higher priority tasks, and therefore we will notice a
higher jitter in those low-priority tasks than before.</p>
</div>
<div class="section" id="static-memory-areas">
<h3>1.4.3.1.4. Static Memory Areas<a class="headerlink" href="#static-memory-areas" title="Permalink to this headline">¶</a></h3>
<p>In VxWorks, all memory areas from the application are by default
allocated dynamically on the heap. If this is not intended for some
reasons, it is possible to specify one or more static memory areas in
the runtime configuration file.</p>
<p>The user is able to move any area to a fix address (Code, data, input,
output, retain,...), but it is especially useful to define his own
areas.</p>
<p>For this purpose, we have the reserved upper 4 bits of the area flags
which can be used by the user to move some data to his own special
areas. He can do this by specifying the following attribute:</p>
<div class="highlight-C"><div class="highlight"><pre><span></span>{attribute &#39;location&#39; := &#39;16#8000&#39;}
</pre></div>
</div>
<p>The 16#8000 is the area flag and should be the same as it is specified
in the configuration file. E.g.:</p>
<div class="highlight-C"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SysMem</span><span class="p">]</span>
<span class="n">VxWorks</span><span class="p">.</span><span class="n">Area</span><span class="mf">.0</span><span class="p">.</span><span class="n">Flags</span><span class="o">=</span><span class="mh">0x8000</span>
<span class="n">VxWorks</span><span class="p">.</span><span class="n">Area</span><span class="mf">.0</span><span class="p">.</span><span class="n">Address</span><span class="o">=</span><span class="mh">0x60540010</span>
<span class="n">VxWorks</span><span class="p">.</span><span class="n">Area</span><span class="mf">.0</span><span class="p">.</span><span class="n">Size</span><span class="o">=</span><span class="mh">0x10000</span>
</pre></div>
</div>
<p>Note, that the areas are always parsed from top down, and that the first
area that matches the requested area flags is used. Therefore, you
should not define the first area with the flags 0xFEFF or similar, but
0x0EFF instead.</p>
</div>
</div>
<div class="section" id="global-object-pools">
<h2>1.4.3.2. Global object pools<a class="headerlink" href="#global-object-pools" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">If you have two or more instances of the CODESYS Runtime, running on
the same PLC, you might want to share Events and SharedMemories.
Especially this is necessary if you want to use our CmpBlkDrvShm to do
real communication and routing on a CODESYS level between the
Instances. But even if you are running only one instance of CODESYS,
but want to communicate with some of your own external firmware
components, which are not running inside of our CODESYS Runtime, you
might have the need to share some memory or send events between each
other.</div>
<div class="line">For these scenarios, CODESYS on VxWorks provides a global object pool
for:</div>
</div>
<ul class="simple">
<li>events</li>
<li>semaphores</li>
<li>shared memories</li>
</ul>
<div class="line-block">
<div class="line">To share the global symbol table across application image boundaries,
the runtime emits a new symbol at first startup, called
„g_PlcObjTab&#8221;. This symbol is created only on the first instantiation
of the runtime. All memory within this table does not belong the
process image. It is allocated dynamically on the heap.</div>
<div class="line">Between different instances of the CODESYS runtime, those objects are
shared automatically, based on their name. To use the objects
independently from the CODESYS runtime, you can read the data from the
table manually in your part of the firmware. The shared object table
has the following structure:</div>
</div>
<div class="highlight-C"><div class="highlight"><pre><span></span><span class="cp">#define OBJTAB_VERSION 0x00000001</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">objTabType_e</span> <span class="p">{</span>
<span class="n">e_shm</span><span class="p">,</span>
<span class="n">e_sem</span><span class="p">,</span>
<span class="n">e_evt</span>
<span class="p">}</span> <span class="n">objTabType_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">shmEntry_s</span> <span class="p">{</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ulAddress</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ulSize</span><span class="p">;</span>
<span class="p">}</span> <span class="n">shmEntry_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">semEntry_s</span> <span class="p">{</span>
<span class="n">SEM_ID</span> <span class="n">hSem</span><span class="p">;</span>
<span class="p">}</span> <span class="n">semEntry_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">evtEntry_s</span> <span class="p">{</span>
<span class="n">SEM_ID</span> <span class="n">hEvt</span><span class="p">;</span>
<span class="p">}</span> <span class="n">evtEntry_t</span><span class="p">;</span>
<span class="cm">/* base type, which „contains&quot; the above */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">objEntry_s</span> <span class="p">{</span>
<span class="n">objTabType_t</span> <span class="n">tType</span><span class="p">;</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">pszName</span><span class="p">;</span>
<span class="k">union</span> <span class="p">{</span>
<span class="n">shmEntry_t</span> <span class="n">tShmEntry</span><span class="p">;</span>
<span class="n">semEntry_t</span> <span class="n">tSemEntry</span><span class="p">;</span>
<span class="n">evtEntry_t</span> <span class="n">tEvtEntry</span><span class="p">;</span>
<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
<span class="p">}</span> <span class="n">objEntry_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">objTab_s</span> <span class="p">{</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ulVersion</span><span class="p">;</span>
<span class="n">SEM_ID</span> <span class="n">hSem</span><span class="p">;</span>
<span class="n">objEntry_t</span> <span class="o">*</span><span class="n">ptEntries</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ulSize</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ulRefCnt</span><span class="p">;</span>
<span class="p">}</span> <span class="n">objTab_t</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="portings_win_ce_specific.html" title="1.4.4. Windows CE Specific Information"
             >next</a> |</li>
        <li class="right" >
          <a href="portings_linux_specific.html" title="1.4.2. Linux specific information"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RuntimeSystemOnlineHelp V3.5.14.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >1. CODESYS Control V3 - Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="portings.html" >1.4. Portings</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, 3S-Smart Software Solutions GmbH.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
  </body>
</html>