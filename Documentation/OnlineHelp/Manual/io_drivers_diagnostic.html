

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>5.8.8. Diagnostic Information &#8212; RuntimeSystemDocumentation V3.5.16.40</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/theme.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.8.9. IO Consistency" href="io_drivers_io_consistency.html" />
    <link rel="prev" title="5.8.7. Drivers in IEC" href="io_drivers_in_iec.html" /> 
  </head><body>
	<div id="header">
		<a href="#" title="CODESYS" target="_top" id="logo"><img src="../_static/logo.png" width="134" height="130" alt=""></a>
		<a href="#" title="CODESYS Documentation" target="_top" id="logo-store"><img src="../_static/logo2.png" width="137" height="130" alt=""></a>
	</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="io_drivers_io_consistency.html" title="5.8.9. IO Consistency"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="io_drivers_in_iec.html" title="5.8.7. Drivers in IEC"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RuntimeSystemDocumentation V3.5.16.40</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >5. Architecture Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="io_drivers.html" accesskey="U">5.8. I/O Drivers</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h4>Previous topic</h4>
  <p class="topless"><a href="io_drivers_in_iec.html"
                        title="previous chapter">5.8.7. Drivers in IEC</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="io_drivers_io_consistency.html"
                        title="next chapter">5.8.9. IO Consistency</a></p>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="diagnostic-information">
<span id="io-drivers-diagnostic"></span><h1>5.8.8. Diagnostic Information<a class="headerlink" href="#diagnostic-information" title="Permalink to this headline">¶</a></h1>
<p>The diagnostic information consists of two different parts:</p>
<ol class="arabic simple">
<li><p>Bit-Field in every connector for the <strong>general</strong> diagnostic
information</p></li>
</ol>
<ol class="arabic simple">
<li><p>Extended diagnostic information of a device with <strong>detailed</strong>
information</p></li>
</ol>
<p>The Bit-Field can be used e.g. for the online-diagnostic information in
the device tree to see, if one device has an error or has some
information for the user.</p>
<p>The extended diagnostic information can be used to display some device
specific information about an error or a special detected state.</p>
<p>These parameters are explained now in detail.</p>
<div class="section" id="general-diagnostic-information-bit-field">
<h2>5.8.8.1. General diagnostic information bit-field<a class="headerlink" href="#general-diagnostic-information-bit-field" title="Permalink to this headline">¶</a></h2>
<p>The actual state of a device can be published in a bit-field, that is a
generic part of each connector. This is a bit-field (32-Bit) with the
following meaning:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 34%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bitname</p></th>
<th class="head"><p>Bit-Value</p></th>
<th class="head"><p>Is set
by</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CF_ENABLE</p></td>
<td><p>0x0001</p></td>
<td><p>IO-Config</p></td>
<td><p>Connector enabled in the IO-configuration</p></td>
</tr>
<tr class="row-odd"><td><p>CF_DRIVER_AVAILABLE</p></td>
<td><p>0x0010</p></td>
<td><p>CmpIoMgr</p></td>
<td><p>A driver has registered to this device,
so the device will be supported by a driver.</p></td>
</tr>
<tr class="row-even"><td><p>CF_CONNECTOR_FOUND</p></td>
<td><p>0x0020</p></td>
<td><p>IoDriver</p></td>
<td><p>Connector found (device detected)</p></td>
</tr>
<tr class="row-odd"><td><p>CF_CONNECTOR_CONFIGURED</p></td>
<td><p>0x0040</p></td>
<td><p>IoDriver</p></td>
<td><p>Connector configured</p></td>
</tr>
<tr class="row-even"><td><p>CF_CONNECTOR_ACTIVE</p></td>
<td><p>0x0080</p></td>
<td><p>IoDriver</p></td>
<td><p>Connector active
(bus is active)</p></td>
</tr>
<tr class="row-odd"><td><p>CF_CONNECTOR_BUS_ERROR</p></td>
<td><p>0x0100</p></td>
<td><p>IoDriver</p></td>
<td><p>Bus error</p></td>
</tr>
<tr class="row-even"><td><p>CF_CONNECTOR_ERROR</p></td>
<td><p>0x0200</p></td>
<td><p>IoDriver</p></td>
<td><p>General error</p></td>
</tr>
<tr class="row-odd"><td><p>CF_CONNECTOR_DIAGNOSTIC_AVAILABLE</p></td>
<td><p>0x0400</p></td>
<td><p>IoDriver</p></td>
<td><p>Extended diagnostic information available</p></td>
</tr>
</tbody>
</table>
<p>The Connector flags must always be set out of the IO-diver with the
functions IoMgrConfigSetDiagnosis() and IoMgrConfigResetDiagnosis() of
the IO-manager to set and reset single diagnostic bits.</p>
<p>If CF_CONNECTOR_DIAGNOSTIC_AVAILABLE is set, two diagnostic
parameters out of the device description are used to transmit further
extended information.</p>
<p>This bitfields is monitored by CODESYS, if the target is online.</p>
<p>If everything is OK (the bits CF_ENABLE, CF_DRIVER_AVAILABLE,
CF_CONNECTOR_FOUND, CF_CONNECTOR_CONFIGURED, CF_CONNECTOR_ACTIVE
are set), the following Icon is displayed at the corresponding device
(connector):</p>
<img alt="../_images/icon_fieldbus_running.png" src="../_images/icon_fieldbus_running.png" />
<p>If something is wrong (one of the bits CF_CONNECTOR_BUS_ERROR,
CF_CONNECTOR_ERROR or CF_CONNECTOR_DIAGNOSTIC_AVAILABLE is set or
one of the other bits is not set), the following Icon is displayed at
the corresponding device (connector):</p>
<img alt="../_images/icon_fieldbus_init.png" src="../_images/icon_fieldbus_init.png" />
<p>After a new initialization of the fieldbus (new download, reset of
application) the state of a fieldbus (CF_CONNECTOR_ACTIVE flag is set
or not) depends on whether the fieldbus is already running or not. This
means that it depends on the fieldbus, if the connector has got a green
(fieldbus already running) or an red (fieldbus not running) icon after a
new initialization.</p>
<p>The table shows the icons of some field busses after a new
initialization:</p>
</div>
<div class="section" id="extended-diagnostic-parameter">
<h2>5.8.8.2. Extended diagnostic parameter<a class="headerlink" href="#extended-diagnostic-parameter" title="Permalink to this headline">¶</a></h2>
<p>The parameter with the attribute “diag” can be a structure, string or
whatever. This contains the extended diagnostic information of this
device, if the corresponding device dialog with the register card
“Status” is opened in CODESYS. In this situation, a IoDrvReadParameter()
/IoDrvReadParameterById() is called of the corresponding driver of the
device.</p>
<p>The parameter can be specified in the device description as followed:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">Parameter</span> <span class="n">ParameterId</span><span class="o">=</span><span class="s">&quot;327936&quot;</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;local:TslaveDiag&quot;</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">Attributes</span> <span class="n">channel</span><span class="o">=</span><span class="s">&quot;diag&quot;</span> <span class="n">download</span><span class="o">=</span><span class="s">&quot;true&quot;</span> <span class="n">functional</span><span class="o">=</span><span class="s">&quot;false&quot;</span> <span class="n">offlineaccess</span><span class="o">=</span><span class="s">&quot;read&quot;</span> <span class="n">onlineaccess</span><span class="o">=</span><span class="s">&quot;read&quot;</span> <span class="o">/&gt;</span>
   <span class="o">&lt;</span><span class="n">Default</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">Element</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Status1&quot;</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">Element</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">Element</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Status2&quot;</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">Element</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">Element</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Status3&quot;</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">Element</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">Element</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;MasterAddress&quot;</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">Element</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">Element</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;IdentNumberHigh&quot;</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">Element</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">Element</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;IdentNumberLow&quot;</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">Element</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">Element</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;ExtDiag en&quot;</span><span class="o">&gt;</span><span class="mi">58</span><span class="o">&lt;/</span><span class="n">Element</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">Element</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;ExtDiag&quot;</span><span class="o">&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;/</span><span class="n">Element</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">Default</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">Name</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;local:Id327936&quot;</span><span class="o">&gt;</span><span class="n">SlaveDiag</span><span class="o">&lt;/</span><span class="n">Name</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">Description</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;local:Id327936.Desc&quot;</span><span class="o">&gt;</span><span class="n">ProfiBus</span> <span class="n">DP</span> <span class="n">slave</span> <span class="n">diagnostic</span> <span class="n">information</span><span class="o">&lt;/</span><span class="n">Description</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">Parameter</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="extended-diagnostic-acknowledge-parameter">
<h2>5.8.8.3. Extended diagnostic acknowledge parameter<a class="headerlink" href="#extended-diagnostic-acknowledge-parameter" title="Permalink to this headline">¶</a></h2>
<p>To acknowledge the extended diagnostic information, there is a second
parameter with the attribute “diagAck”. This is always a <strong>bool</strong>
parameter to reset the CF_CONNECTOR_DIAGNOSTIC _AVAILABLE bit. This
is executed by pressing the Diag Acknowledge button in the device
dialog. In this situation, a IoDrvWriteParameter()
/IoDrvWriteParameterById() is called of the corresponding driver of the
device.</p>
<p>After pressing this button, the diag flag
CF_CONNECTOR_DIAGNOSTIC_AVAILABLE must be reset by the IO-driver.
After this, the parameter with the “diag” attribute is never read by
CODESYS, until CF_CONNECTOR_DIAGNOSTIC_AVAILABLE is set the next
time.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">Parameter</span> <span class="n">Parameter</span><span class="s">&quot;d=&quot;</span><span class="mi">327937</span><span class="s">&quot; type=&quot;</span><span class="nl">std</span><span class="p">:</span><span class="n">BOOL</span><span class="s">&quot;&gt;</span>
  <span class="o">&lt;</span><span class="n">Attributes</span> <span class="n">channel</span><span class="o">=</span><span class="s">&quot;diagack&quot;</span> <span class="n">download</span><span class="o">=</span><span class="s">&quot;true&quot;</span> <span class="n">functional</span><span class="o">=</span><span class="s">&quot;false&quot;</span> <span class="n">offlineaccess</span><span class="o">=</span><span class="s">&quot;read&quot;</span> <span class="n">onlineaccess</span><span class="o">=</span><span class="s">&quot;readwrite&quot;</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="n">Default</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">Default</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">Name</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;local:Id327937&quot;</span><span class="o">&gt;</span><span class="n">SlaveDiagAcknowledge</span><span class="o">&lt;/</span><span class="n">Name</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">Description</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;local:Id327937.Desc&quot;</span><span class="o">&gt;</span><span class="n">ProfiBus</span> <span class="n">DP</span> <span class="n">slave</span> <span class="n">diagnostic</span> <span class="n">acknowledge</span><span class="o">&lt;/</span><span class="n">Description</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">Parameter</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="implementation-notes">
<h2>5.8.8.4. Implementation notes<a class="headerlink" href="#implementation-notes" title="Permalink to this headline">¶</a></h2>
<p>To realize an identical behavior of all IO-drivers regarding the
IO-diagnostic information, some implementation details and requirement
must be known:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 82%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Requirement</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>R01</p></td>
<td><p>The diagnostic bits in the Bit-Field must be written cyclically from the IO-driver
itself! For this, the standard IO-driver interface function IoDrvGetModuleDiagnosis()
contains the cyclic diagnostic transfer.
This function is not called automatically from the runtime kernel.
Typically, this function is called implicit in the IO-driver in IoDrvStartBusCycle.</p></td>
</tr>
<tr class="row-odd"><td><p>R02</p></td>
<td><p>IoDrvGetModuleDiagnosis() must only set the diagnostic bits cyclically and must not
read any time consuming specific diagnostic information of a slave! So the runtime of
this function must be as short as possible, because this has an effect on the cycle
time of an IEC-task!
If the time is too long to set the information in one cycle, only diagnostic
information of a few slaves should be read per cycle!</p></td>
</tr>
<tr class="row-even"><td><p>R03</p></td>
<td><p>If a slave is disabled in the IO-configuration, no diagnostic information may be set
(CF_ENABLE is disabled in this case)</p></td>
</tr>
<tr class="row-odd"><td><p>R04</p></td>
<td><p>If a slave is configured but not available physically (e.g. bus is disconnected),
the diagnostic information must be updated always!</p></td>
</tr>
<tr class="row-even"><td><p>R05</p></td>
<td><p>Unimportant extended diagnostic information should be acknowledged and handled by the
IO-driver implicitly. This depends on the type of fieldbus:
<strong>Profibus DP:</strong>
For example, if a slave informs about the activation of the watchdog is a information,
that can be implicitly acknowledged.</p></td>
</tr>
<tr class="row-odd"><td><p>R06</p></td>
<td><p>The relevant extended diagnostic information must be available, until this parameter
is acknowledged by the user (or the program!) with the extended diagnostic
acknowledge parameter!</p></td>
</tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="io_drivers_io_consistency.html" title="5.8.9. IO Consistency"
             >next</a> |</li>
        <li class="right" >
          <a href="io_drivers_in_iec.html" title="5.8.7. Drivers in IEC"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RuntimeSystemDocumentation V3.5.16.40</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >5. Architecture Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="io_drivers.html" >5.8. I/O Drivers</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, 3S-Smart Software Solutions GmbH. This document is confidential. Unauthorized copying, disclosure or distribution of this document and the information contained herein is strictly forbidden.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>